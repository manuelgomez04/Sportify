<app-navbar></app-navbar>
<div class="container py-4">
  <h2 class="fw-bold mb-4">Mis Comentarios</h2>
  <h5 class="mb-3">Comentarios Recientes</h5>
  <div *ngIf="comentarios.length > 0">
    <div *ngFor="let c of comentarios" class="d-flex align-items-start mb-4 position-relative">
      <img [src]="c.usuario.fotoPerfil ? '/download/' + c.usuario.fotoPerfil : 'assets/default-profile.png'"
        alt="avatar" class="rounded-circle me-3" width="56" height="56">
      <div class="flex-grow-1">
        <div class="fw-bold">{{ c.usuario.username }}</div>
        <div class="text-muted small mb-1">{{ c.noticia.titular }}</div>
        <div class="text-muted small mb-1">{{ c.fecha | date:'yyyy-MM-dd' }}</div>
        <div class="mb-1"><strong>{{ c.titular }}</strong></div>
        <div>{{ c.comentario }}</div>
      </div>
      <button class="btn btn-outline-secondary btn-sm ms-2 align-self-start" title="Editar" (click)="abrirEditar(c)"
        style="height:32px; width:32px; display:flex; align-items:center; justify-content:center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-pencil"
          viewBox="0 0 16 16">
          <path
            d="M12.146.854a.5.5 0 0 1 .708 0l2.292 2.292a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zm.708-.708a1.5 1.5 0 0 0-2.121 0l-10 10a1.5 1.5 0 0 0-.328.497l-2 5a1.5 1.5 0 0 0 1.95 1.95l5-2a1.5 1.5 0 0 0 .497-.328l10-10a1.5 1.5 0 0 0 0-2.121l-2.292-2.292z" />
        </svg>
      </button>
    </div>
    <div class="text-center mt-3" *ngIf="page + 1 < totalPages">
      <button class="btn btn-primary" (click)="cargarMasComentarios()">Cargar más</button>
    </div>
  </div>
  <div *ngIf="comentarios.length === 0" class="text-muted text-center py-5">
    No tienes comentarios.
  </div>

  <!-- Modal de edición de comentario -->
  <div *ngIf="editandoComentario" class="custom-modal-backdrop">
    <div class="custom-modal">
      <form [formGroup]="editComentarioForm" (ngSubmit)="guardarEdicion()">
        <div class="modal-header">
          <h5 class="modal-title">Editar Comentario</h5>
          <button type="button" class="btn-close" (click)="cerrarEditar()" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Título</label>
            <input formControlName="titulo" class="form-control" maxlength="100" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Comentario</label>
            <textarea formControlName="comentario" class="form-control" rows="4" maxlength="500" required></textarea>
          </div>
          <div *ngIf="editError" class="alert alert-danger" [innerHTML]="editError"></div>
          <div *ngIf="editSuccess" class="alert alert-success">¡Comentario editado correctamente!</div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="cerrarEditar()">Cancelar</button>
          <button type="submit" class="btn btn-primary" [disabled]="editComentarioForm.invalid || editLoading">
            Guardar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>